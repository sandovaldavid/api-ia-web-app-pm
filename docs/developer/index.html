<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Documentaci√≥n para Desarrolladores - API Intermediaria</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <style>
            body {
                padding-top: 2rem;
                padding-bottom: 2rem;
            }
            .dev-container {
                max-width: 900px;
                margin: 0 auto;
            }
            .code-block {
                background-color: #f8f9fa;
                padding: 1rem;
                border-radius: 0.3rem;
                margin-bottom: 1rem;
            }
            .nav-pills .nav-link.active {
                background-color: #0d6efd;
            }
            .breadcrumb {
                margin-bottom: 2rem;
            }
        </style>
    </head>
    <body>
        <div class="container dev-container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Inicio</a></li>
                    <li class="breadcrumb-item"><a href="/docs/">Documentaci√≥n</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Gu√≠a para Desarrolladores</li>
                </ol>
            </nav>

            <div class="d-flex align-items-center mb-4">
                <h1><i class="bi bi-code-slash"></i> Documentaci√≥n para Desarrolladores</h1>
            </div>

            <div class="alert alert-info">
                <strong>üëâ Nota:</strong> Esta secci√≥n est√° destinada a desarrolladores que quieran contribuir al
                proyecto o entender su estructura interna.
            </div>

            <div class="row mt-5">
                <div class="col-md-3">
                    <div class="sticky-top pt-3">
                        <nav class="nav flex-column nav-pills">
                            <a class="nav-link active" href="#arquitectura">Arquitectura</a>
                            <a class="nav-link" href="#estructura">Estructura del Proyecto</a>
                            <a class="nav-link" href="#flujo">Flujo de Datos</a>
                            <a class="nav-link" href="#modelos">Modelos de Datos</a>
                            <a class="nav-link" href="#servicios">Servicios</a>
                            <a class="nav-link" href="#auth">Autenticaci√≥n</a>
                            <a class="nav-link" href="#contribuir">C√≥mo Contribuir</a>
                        </nav>
                    </div>
                </div>

                <div class="col-md-9">
                    <section id="arquitectura" class="mb-5">
                        <h2>üèóÔ∏è Arquitectura</h2>
                        <p>La API Intermediaria sigue una arquitectura en capas con separaci√≥n de responsabilidades:</p>
                        <img
                            src="../assets/architecture.png"
                            alt="Diagrama de Arquitectura"
                            class="img-fluid border rounded my-3"
                        />
                        <ul>
                            <li><strong>Capa de Presentaci√≥n:</strong> Rutas y controladores REST</li>
                            <li>
                                <strong>Capa de L√≥gica de Negocio:</strong> Servicios que interact√∫an con Django y
                                Ollama
                            </li>
                            <li>
                                <strong>Capa de Persistencia:</strong> Modelos MongoDB para almacenar usuarios, chats y
                                mensajes
                            </li>
                        </ul>
                    </section>

                    <section id="estructura" class="mb-5">
                        <h2>üìÇ Estructura del Proyecto</h2>
                        <div class="code-block">
                            <pre>
src/
‚îú‚îÄ‚îÄ config/          # Configuraci√≥n (base de datos, variables de entorno)
‚îú‚îÄ‚îÄ controllers/     # Controladores para cada recurso
‚îú‚îÄ‚îÄ middlewares/     # Middlewares (auth, validaci√≥n, manejo de errores)
‚îú‚îÄ‚îÄ models/          # Modelos MongoDB (Usuario, Mensaje, Chat)
‚îú‚îÄ‚îÄ routes/          # Rutas API para cada recurso
‚îú‚îÄ‚îÄ services/        # Servicios externos (Django, Ollama)
‚îú‚îÄ‚îÄ utils/           # Utilidades y helpers
‚îú‚îÄ‚îÄ app.js           # Configuraci√≥n Express
‚îî‚îÄ‚îÄ server.js        # Punto de entrada</pre
                            >
                        </div>
                    </section>

                    <section id="flujo" class="mb-5">
                        <h2>üîÑ Flujo de Datos</h2>
                        <p>El flujo t√≠pico de una solicitud es el siguiente:</p>
                        <ol>
                            <li>El cliente env√≠a una petici√≥n HTTP a una ruta espec√≠fica</li>
                            <li>Los middlewares de autenticaci√≥n y validaci√≥n procesan la petici√≥n</li>
                            <li>El controlador correspondiente recibe la petici√≥n validada</li>
                            <li>
                                El controlador utiliza los servicios para obtener datos (Django) y procesarlos (Ollama)
                            </li>
                            <li>El resultado se almacena en MongoDB y se devuelve al cliente</li>
                        </ol>
                        <div class="alert alert-warning">
                            <strong>‚ö†Ô∏è Importante:</strong> Todas las comunicaciones con servicios externos deben ser
                            manejadas por los m√≥dulos de servicio, no directamente en los controladores.
                        </div>
                    </section>

                    <section id="modelos" class="mb-5">
                        <h2>üìä Modelos de Datos</h2>
                        <p>La aplicaci√≥n utiliza MongoDB con Mongoose como ODM. Los principales modelos son:</p>

                        <h4>User</h4>
                        <p>Representa a un usuario de la aplicaci√≥n:</p>
                        <div class="code-block">
                            <pre>
const UserSchema = new mongoose.Schema({
  name: String,
  email: String,
  password: String,  // Cifrado con bcrypt
  role: String,      // 'user' o 'admin'
  createdAt: Date
});</pre
                            >
                        </div>

                        <h4>Chat</h4>
                        <p>Representa una conversaci√≥n que contiene mensajes:</p>
                        <div class="code-block">
                            <pre>
const ChatSchema = new mongoose.Schema({
  title: String,
  user: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
  taskId: String,    // ID de tarea en Django
  projectId: String, // ID de proyecto en Django
  status: String,    // 'active' o 'archived'
  lastMessage: Date,
  createdAt: Date,
  updatedAt: Date
});</pre
                            >
                        </div>

                        <h4>Message</h4>
                        <p>Representa un mensaje individual dentro de un chat:</p>
                        <div class="code-block">
                            <pre>
const MessageSchema = new mongoose.Schema({
  user: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
  chat: { type: mongoose.Schema.Types.ObjectId, ref: 'Chat' },
  requestType: String,  // Tipo de mensaje/solicitud
  prompt: String,       // Texto enviado por el usuario
  response: Object,     // Respuesta de la IA (puede ser compleja)
  taskId: String,
  projectId: String,
  createdAt: Date
});</pre
                            >
                        </div>
                    </section>

                    <section id="servicios" class="mb-5">
                        <h2>üåê Servicios</h2>
                        <p>Los principales servicios de la aplicaci√≥n son:</p>

                        <h4>Django Service</h4>
                        <p>Maneja la comunicaci√≥n con la API de Django:</p>
                        <div class="code-block">
                            <pre>
// djangoService.js
// Funciones para obtener tareas, proyectos y recursos de Django
exports.getTaskById = async (taskId) => {
  // Implementaci√≥n
};</pre
                            >
                        </div>

                        <h4>Ollama Service</h4>
                        <p>Maneja la comunicaci√≥n con la API de Ollama (IA):</p>
                        <div class="code-block">
                            <pre>
// ollamaService.js
// Funciones para generar completions con Ollama
exports.generateCompletion = async (prompt) => {
  // Implementaci√≥n
};</pre
                            >
                        </div>
                    </section>

                    <section id="auth" class="mb-5">
                        <h2>üîê Autenticaci√≥n</h2>
                        <p>La autenticaci√≥n utiliza JWT (JSON Web Tokens):</p>
                        <ul>
                            <li>Los tokens son generados al iniciar sesi√≥n o registrarse</li>
                            <li>
                                El middleware <code>protect</code> verifica los tokens en cada petici√≥n a rutas
                                protegidas
                            </li>
                            <li>Los tokens contienen el ID del usuario y tienen una expiraci√≥n configurable</li>
                        </ul>

                        <div class="code-block">
                            <pre>
// Ejemplo de protecci√≥n de ruta
router.get('/me', protect, userController.getMe);</pre
                            >
                        </div>
                    </section>

                    <section id="contribuir" class="mb-5">
                        <h2>üë©‚Äçüíª C√≥mo Contribuir</h2>
                        <ol>
                            <li>Haz fork del repositorio</li>
                            <li>
                                Crea una nueva rama para tu funcionalidad:
                                <code>git checkout -b feature/nueva-funcion</code>
                            </li>
                            <li>Implementa tus cambios siguiendo las convenciones del proyecto</li>
                            <li>Ejecuta y crea pruebas para tu c√≥digo</li>
                            <li>Env√≠a un pull request a la rama principal</li>
                        </ol>

                        <h4>Convenciones de C√≥digo</h4>
                        <ul>
                            <li>Usa nombres descriptivos para variables y funciones</li>
                            <li>Comenta secciones complejas del c√≥digo</li>
                            <li>Sigue el patr√≥n de manejo de errores existente</li>
                            <li>Mant√©n un estilo consistente con el resto del proyecto</li>
                        </ul>
                    </section>
                </div>
            </div>

            <hr class="my-5" />

            <div class="text-center">
                <p>
                    ¬øTienes preguntas sobre el desarrollo? Cont√°ctanos en
                    <a href="mailto:soporte@api-intermediaria.com">soporte@api-intermediaria.com</a>
                </p>
                <a href="/docs/" class="btn btn-primary">Volver a Documentaci√≥n</a>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
